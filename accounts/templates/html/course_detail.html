{% extends 'html/dashboard_base.html' %}
{% load custom_filters %}
{% block extra_css %}
    <link rel="stylesheet" href="{% static 'accounts/css/course_detail.css' %}">
{% endblock %}
{% block content %}
<div class="container course-page">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb" style="margin-bottom: 32px;">
        <ol class="breadcrumb" style="background: none; padding: 0;">
            <li class="breadcrumb-item">
                <a href="{% url 'accounts:user_dashboard' %}" style="color: #666; font-weight: 500; text-decoration: none; display: flex; align-items: center; gap: 8px;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M15 18l-6-6 6-6"/>
                    </svg>
                    Dashboard
                </a>
            </li>
        </ol>
    </nav>

    <!-- Course Header -->
    <div class="course-header" style="background: linear-gradient(135deg, #fff, #f8f9fa); border-radius: 24px; padding: 40px; margin-bottom: 40px; box-shadow: 0 4px 24px rgba(0,0,0,0.06);">
        <div style="display: flex; gap: 40px; align-items: flex-start;">
            <!-- Course Image -->
            {% if course.image %}
                <div class="course-image" style="flex-shrink: 0;">
                    <img src="{{ course.image.url }}" alt="{{ course.title }}" 
                         style="width: 240px; height: 240px; object-fit: cover; border-radius: 20px; 
                                box-shadow: 0 8px 24px rgba(0,0,0,0.12); transition: transform 0.3s ease;">
                </div>
            {% endif %}
            
            <!-- Course Info -->
            <div class="course-info" style="flex-grow: 1;">
                <h1 style="font-size: 2.5rem; font-weight: 800; background: linear-gradient(90deg,#b3001b,#ff2e43); 
                           -webkit-background-clip: text; color: transparent; margin-bottom: 20px;">
                    {{ course.title }}
                </h1>
                
                <!-- Course Stats -->
                <div class="course-stats" style="display: flex; gap: 32px; margin-bottom: 24px;">
                    <div style="display: flex; align-items: center; gap: 8px; color: #666;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/>
                        </svg>
                        <span>{{ lessons|length }} bài học</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px; color: #666;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/>
                            <line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/>
                        </svg>
                        <span>Ngày tạo: {{ course.created_at|date:"d/m/Y" }}</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px; color: #666;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                        </svg>
                        <span>Thời lượng: {{ total_duration }} phút</span>
                    </div>
                </div>

                <!-- Course Description -->
                <div class="course-description" style="color: #444; font-size: 1.1rem; line-height: 1.6; margin-bottom: 32px;">
                    {{ course.description }}
                </div>

                <!-- Action Buttons -->
                <div class="course-actions" style="display: flex; gap: 16px; align-items: center;">
                    {% if is_enrolled %}
                        <div class="enrollment-badge" style="background: linear-gradient(135deg, #28a745, #34ce57); 
                             padding: 8px 20px; border-radius: 12px; color: white; font-weight: 600; 
                             display: flex; align-items: center; gap: 8px; box-shadow: 0 4px 12px rgba(40,167,69,0.2);">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M20 6L9 17l-5-5"/>
                            </svg>
                            Đã đăng ký
                        </div>
                        <div class="progress-container">
                            <div class="progress-label">Tiến độ khóa học: {{ progress_percent }}%</div>
                            <div class="progress-bar"><div class="progress-fill" style="width: {{ progress_percent }}%"></div></div>
                        </div>
                        {% if lessons and lessons|length > 0 %}
                            <a href="{% url 'accounts:lesson_detail' course.id lessons.0.id %}" 
                               style="padding: 14px 36px; border-radius: 12px; 
                                      background: linear-gradient(135deg, #b3001b, #ff2e43); 
                                      color: #fff; font-weight: 600; font-size: 1.1rem; 
                                      text-decoration: none; border: none; 
                                      box-shadow: 0 4px 15px rgba(255,46,67,0.2); 
                                      transition: all 0.3s ease;
                                      display: flex; align-items: center; gap: 8px;">
                                <span>Vào học ngay</span>
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M5 12h14M12 5l7 7-7 7"/>
                                </svg>
                            </a>
                        {% endif %}
                    {% else %}
                        <form method="POST" action="{% url 'accounts:enroll_course' course.id %}">
                            {% csrf_token %}
                            <button type="submit" 
                                    style="padding: 14px 36px; border-radius: 12px; 
                                           background: linear-gradient(135deg, #b3001b, #ff2e43); 
                                           color: #fff; font-weight: 600; font-size: 1.1rem; 
                                           border: none; box-shadow: 0 4px 15px rgba(255,46,67,0.2); 
                                           transition: all 0.3s ease;
                                           display: flex; align-items: center; gap: 8px;
                                           cursor: pointer;">
                                <span>Đăng ký học ngay</span>
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M5 12h14M12 5l7 7-7 7"/>
                                </svg>
                            </button>
                        </form>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Course Content -->
    <div class="course-content" style="background: white; border-radius: 24px; padding: 40px; box-shadow: 0 4px 24px rgba(0,0,0,0.06);">
        <h2 style="font-size: 1.5rem; font-weight: 700; color: #1a1a1a; margin-bottom: 24px; 
                   display: flex; align-items: center; gap: 12px;">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
            </svg>
            Nội dung khóa học
        </h2>
        
        <div class="lesson-grid" style="display: grid; gap: 16px;">
            {% for lesson in lessons %}
                <div class="lesson-card" style="background: #f8f9fa; border-radius: 16px; padding: 20px; 
                                              display: flex; align-items: center; justify-content: space-between;
                                              transition: all 0.3s ease;">
                    <div style="display: flex; align-items: center; gap: 16px;">
                        <div style="width: 40px; height: 40px; background: #fff; border-radius: 50%; 
                                  display: flex; align-items: center; justify-content: center; 
                                  box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
                            {{ forloop.counter }}
                        </div>
                        <div>
                            <h3 style="font-size: 1.1rem; font-weight: 600; color: #1a1a1a; margin: 0;">
                                {{ lesson.title }}
                            </h3>
                            <span style="color: #666; font-size: 0.9rem;">45 phút</span>
                        </div>
                    </div>
                    {% if lesson.id in lesson_progress and lesson_progress|get_item:lesson.id|get_item:'completed' %}
                        <span style="background: #28a745; color: white; padding: 6px 12px; 
                                   border-radius: 20px; font-size: 0.9rem; font-weight: 500;">
                            Hoàn thành
                        </span>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}